#compdef gwm

# GWM (Git Worktree Manager) zsh completion
# Source this file or place it in a directory in your $fpath (e.g., /usr/local/share/zsh/site-functions/)
# Then run: compinit

_gwm() {
    local -a commands worktrees branches
    commands=(
        'add:Add a new worktree'
        'switch:Switch to an existing worktree'
        'clean:Delete current worktree and return to main repo'
        'list:List all worktrees'
    )

    case $words[2] in
        add)
            # Complete branch names for add command
            branches=(${(@f)"$(git branch --all 2>/dev/null | grep -v 'HEAD' | sed 's/^[[:space:]]*//' | sed 's/^[*[:space:]]*//' | sed 's|^remotes/[^/]*/||' | sort | uniq)"})
            _describe -t branches 'branch' branches
            ;;
        switch|list)
            # Complete worktree names for switch and list commands
            worktrees=(${(@f)"$(gwm list 2>/dev/null | grep -v '^Found' | sed 's/^[[:space:]]*//' | cut -d' ' -f1)"})
            _describe -t worktrees 'worktree' worktrees
            ;;
        *)
            # Complete command names
            _describe -t commands 'command' commands
            ;;
    esac
}

_gwm